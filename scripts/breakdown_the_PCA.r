
####
# set the working directory
####

data_path = "C:/Users/camnu/bin/salmon-genomic-vulnerability/data/"
setwd(data_path)


####
# load necessary libraries
####

library(tidyverse)
library(data.table)
library(pcadapt)


####
# Read in the metadata and full PCA file
####
NA_PC_Meta = read_tsv("full_wild_PCA_and_meta.tsv")


####
# look at the plot to find the sub-groups
####

location_pca_of_filtered_NA_wild = ggplot() + 
  geom_point(data = NA_PC_Meta, aes(x =PC1, y = PC2, colour = location_id))  +
  labs(title = "PCA of filtered genetic variation - North American wild individuals",
       subtitle = "coloured by river (149 unique),  5455 individuals, 65576 SNPs")+
  xlab("PC1 (3.39% of variance)") +
  ylab("PC2 (1.46% variance explained)")+
  theme(legend.position = "none")


Prov_pca_of_filtered_NA_wild = ggplot() + 
  geom_point(data = NA_PC_Meta, aes(x =PC1, y = PC2, colour = Province))  +
  labs(title = "PCA of filtered genetic variation - North American wild individuals",
       subtitle = "coloured by Province/State,  5455 individuals, 65576 SNPs")+
  xlab("PC1 (3.39% of variance)") +
  ylab("PC2 (1.46% variance explained)")

ggsave('external/wild_NA_only_pca_by_Province.png', Prov_pca_of_filtered_NA_wild)


## what is in the top cluster of NL?
## Are these from a specific geographic region?

## Top cluster is 433 individuals, 22 from NL rest labrador

# the other 3535 NL individuals all go to the southern cluster.

# again the PCA essentially draws the map!



######
# subset the different groups

Labrador_samples = NA_PC_Meta[NA_PC_Meta$Province == "NL-Labrador",]
lab_only_filter = Labrador_samples %>% select(location_id,  fish_id)
outfile = "raw/only_Labrador_individuals.tsv"
write.table(lab_only_filter, outfile, col.names = F, row.names = F, quote = F, sep = "\t")

NL_samples = NA_PC_Meta[NA_PC_Meta$Province == "NL",]
NL_only_filter = NL_samples %>% select(location_id,  fish_id)
outfile = "raw/only_NL_individuals.tsv"
NL_only_filter = NL_only_filter[!is.na(NL_only_filter$location_id), ]
write.table(NL_only_filter, outfile, col.names = F, row.names = F, quote = F, sep = "\t")

other_samples = NA_PC_Meta[!NA_PC_Meta$Province %in% c("NL","NL-Labrador"),]
nonNL_only_filter = other_samples %>% select(location_id,  fish_id)
outfile = "raw/only_non_NL_individuals.tsv"
write.table(nonNL_only_filter, outfile, col.names = F, row.names = F, quote = F, sep = "\t")


#######
# subset the files
#######


#plink --bfile wildNA_220k_filtered --chr-set 30 no-xy --keep only_Labrador_individuals.tsv --make-bed --maf 0.01 --out labrador_salmon

#plink --bfile wildNA_220k_filtered --chr-set 30 no-xy --keep only_NL_individuals.tsv --make-bed --maf 0.01 --out nl_salmon

#plink --bfile wildNA_220k_filtered --chr-set 30 no-xy --keep only_non_NL_individuals.tsv --make-bed --maf 0.01 --out non_nl_salmon








