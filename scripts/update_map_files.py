"""
Take the map files based off the previous genome and generate new versions.
Along with the old PEDs this will allow for the LD, Fst, and gene search to be
update relative to v3 of the Atlantic salmon genome.
"""
import os 
import pandas as pd


def read_map_file(infile, header = False):
    """Read in a header, accounting for whether or not there is a header line."""
    if header:
        return pd.read_csv(infile, sep="\t")
    return pd.read_csv(infile, sep="\t", names=['CHR', 'SNP', 'ZERO', 'POS'])

def write_map_file(df, outfile, header = False):
    """Write a map dataframe to a file. Default is without a header"""
    print(f"writing dataframe to file: {outfile}")
    df.to_csv(out_file, header=header)

def update_map_file(old_map, v3_map):
    """Pull the v3 map information for the list of SNPs in the old map.
        
        Maintains the previous order of the SNPs for safe interfacing with
        old map's corresponding PED file."""
    return pd.merge(old_map["SNP"], v3_map, how = "left")

if __name__ == "__main__":

    V3_PREFIX = "v3_updated_"    

    V3_MAP = "../data/raw/genome_update/Ssa220K_v3_Genome.map"
    v3_map = read_map_file(V3_MAP, header = True)

    OLD_MAPS_TO_UPDATE = ["", ""]
    DATA_PATH = "../data/raw/"
    file = "../data/raw/wildNA_220k_vulnerability_work.map"

    for old in OLD_MAPS_TO_UPDATE:
        in_file = DATA_PATH+old
        out_file = DATA_PATH+V3_PREFIX+old
        old_map = read_map_file(in_file, header=False)
        new_map = update_map_file(old_map, v3_map)
        write_map_file(new_map, out_file)