############
# load libraries

library(tidyverse)
library(ggman)
theme_set(theme_bw())


############
# set path
data_path = "C:/Users/camnu/bin/salmon-genomic-vulnerability/data/"
setwd(data_path)


# this will generate the gt counts and HW-test stats for eeach SNP, can then summarize
#plink --file data --hardy

##full#5455 samples
#plink --bfile wildNA_220k_filtered --chr-set 30 no-xy --hardy --out HW_files/full_220k_filtered_HW_out

##435 samples:
#plink --bfile LD_files/Labrador_220k_filtered --chr-set 30 no-xy --hardy --out HW_files/Labrador_HW_output

##3244 samples:
#plink --bfile LD_files/Newfoundland_220k_filtered --chr-set 30 no-xy --hardy --out HW_files/Newfoundland_HW_output

##1776 samples:
#plink --bfile LD_files/STLawrence_220k_filtered --chr-set 30 no-xy --hardy --out HW_files/STLawrence_HW_output



print("remember to check - is there higher heterozygosity in the regions with the high admixture")
print("plot the avg heterozygosity as sorted bars, colour by whether or not they're high admix")
print("if yes, then the coloured bars will cluster to the high end of the sort.")


full_hw = read_table("raw/HW_files/full_220k_filtered_HW_out.hwe")
LAB_hw = read_table("raw/HW_files/Labrador_HW_output.hwe")
NFL_hw = read_table("raw/HW_files/Newfoundland_HW_output.hwe")
STL_hw = read_table("raw/HW_files/STLawrence_HW_output.hwe")


full_hw$cluster = "full"
LAB_hw$cluster = "LAB"
NFL_hw$cluster = "NFL"
STL_hw$cluster = "STL"

all_data = do.call(rbind, list(full_hw, LAB_hw, NFL_hw, STL_hw))

het_summary = all_data %>% 
                group_by(cluster) %>%
                  summarize(mean_obvs_het = mean(`O(HET)`), 
                                mean_expe_het = mean(`E(HET)`))            

het_summary

# cluster   mean_obvs_het mean_expe_het
# 1 full            0.184         0.201
# 2 LAB             0.212         0.228
# 3 NFL             0.201         0.213
# 4 STL             0.189         0.202

print("similar heterozygosity among the different populations")




