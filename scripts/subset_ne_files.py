import os
from random import sample

def subset_individuals_genepop(infile, outfile, n = 400):
    """read in a genepop file and produce file with random subset of individuals of specified size."""
    output = ""
    pop_seen = False
    individual_lines = []
    #read in the lines, separating the headers from the individual info
    with open(infile) as file:
        for line in file:
            if pop_seen:
                individual_lines.append(line)
            else:
                if line.rstrip() == "Pop":
                    pop_seen = True
                output += line
    #get random index positions to keep
    keep_lines = sample(range(len(individual_lines)), n)
    for i in keep_lines:
        output+=individual_lines[i]
    #write to file
    f = open(outfile, "w")
    f.write(output)
    f.close()


if __name__ == "__main__":

    PATH = "../data/raw/ne_work/clusters/pop_files/"
    FILES = [x for x in os.listdir(path) if x[:7]  == "single_"]
    OUT_PREFIX = "r400_"
    for f in FILES:
        print(f"on file: {f}")
        infile = PATH+f
        outfile =  PATH+OUT_PREFIX+f
        subset_individuals_genepop(infile, outfile)

    print("restriction string for the GUI, run with every 50th loci")

    outstr = "["
    for i in range(54202):
        if i % 500 == 0:
            outstr += f"{i},"

    outstr = outstr[:-1] + "]" 
    print(outstr)
    print(len(outstr))