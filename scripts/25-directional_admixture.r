
#########################
# libraries
library(tidyverse)
library(ggforce)
library(ggplot2)
library(rnaturalearth)
library(rnaturalearthdata)

#########################
# functions


alter_cluster_IDs = function(x){
  if(x == "STL"){
    return("Maritimes")
  }else if (x == "NFL"){
    return("Newfoundland")
  }else if (x == "LAB"){
    return("Labrador")
  }else{
    return(x)
  }
}

############
# set path
data_path = "C:/Users/camnu/bin/salmon-genomic-vulnerability/data/"
setwd(data_path)


colour_coord =        c("#16ABEE",  "#CC9753",   "#3EB489" )
names(colour_coord) = c("LAB", "MAR", "NFL")


clusters_per_location  = read_tsv("interim/cluster_and_q_data_combined.tsv")
clusters_per_location$Population = unlist(lapply(clusters_per_location$river_majority_cluster, alter_cluster_IDs))
clusters_per_location$location_id = clusters_per_location$SiteCode





Q_to_name = function(Q){  
  col_dict = c("LAB", "NFL", "MAR")  
  names(col_dict)  =  c("Q3", "Q2", "Q1")
  return(col_dict[[Q]])
}

replace_STL = function(x){
 if(x == "STL"){
   return("MAR")
 } 
  return(x)
}

full_admix$home_cluster = unlist(lapply(full_admix$home_cluster,replace_STL))



non_NFL = full_admix[full_admix$home_cluster != "NFL", ]

mar_v_lab_plot = ggplot(non_NFL, aes(x=Q1, y=Q3, colour = home_cluster)) +
  geom_point(alpha = 0.5) +
  scale_colour_manual(values = colour_coord) +
  xlab("Maritime Population Admixture Proportion")+
  ylab("Labrador Population Admixture Proportion")+
  stat_smooth(method=lm)+
  xlim(0.0, 1.0)+
  ylim(0.0, 1.0)+
  labs(colour = "Majority admixture group") +
  theme_classic()
mar_v_lab_plot


non_LAB = full_admix[full_admix$home_cluster != "LAB", ]

mar_v_nfl_plot = ggplot(non_LAB, aes(x=Q1, y=Q2, colour = home_cluster)) +
  geom_point(alpha = 0.5) +
  scale_colour_manual(values = colour_coord) +
  xlab("Maritime Population Admixture Proportion")+
  ylab("Newfoundland Population Admixture Proportion")+
  stat_smooth(method=lm)+
  xlim(0.0, 1.0)+
  ylim(0.0, 1.0)+
  labs(colour = "Majority admixture group") +
  theme_classic()

mar_v_nfl_plot


non_MAR = full_admix[full_admix$home_cluster != "MAR", ]

lab_v_nfl_plot = ggplot(non_MAR, aes(x=Q3, y=Q2, colour = home_cluster)) +
  geom_point(alpha = 0.5) +
  scale_colour_manual(values = colour_coord) +
  xlab("Labrador Population Admixture Proportion")+
  ylab("Newfoundland Population Admixture Proportion")+
  stat_smooth(method=lm)+
  xlim(0.0, 1.0)+
  ylim(0.0, 1.0)+ 
  labs(colour = "Majority admixture group") +
  theme_classic()
lab_v_nfl_plot



# ##to methods:
# - We searched for evidence of directional admixture by conducting pairwise correlation comparisons of per individual admixture proportions 
# and searching for evidence of non linear correlations.
# - Each pairwise comparison was limited to individuals whose majority admixture proportion was one of the two populations being compared
# 
# #To results:
# - No evidence of directional bias in the admixture analyses was observed (Figure SXXX).

# OR evidence of bias in admixture exchange, with Lab mixing into MAR and NFL mixing into LAB, but reduce evidence of the inverse of those two.

# - lab mixes into MAR, but less MAR into LAB 
  # - most admixture in LAB appears to be from NFL mixing into LAB
# - Lab recieves from NFL, doesn't transfer to NFL as much.
# - NFL and MAR exchange bidirectionally.
# - 


library(patchwork)


print("patchwork version")
mar_v_lab_plot = mar_v_lab_plot + labs(tag = "A")
mar_v_nfl_plot = mar_v_nfl_plot + labs(tag = "B")
lab_v_nfl_plot = lab_v_nfl_plot + labs(tag = "C")

outplot = mar_v_lab_plot | mar_v_nfl_plot | lab_v_nfl_plot


ggsave('external/panelled_admixture_direction_coloured.tiff', outplot, width = 24, height = 8)
ggsave('external/panelled_admixture_direction_coloured.jpeg', outplot, width = 24, height = 8)

print("to improve - colour by majority river cluster (will show directionality better)")