setwd("C:/Users/camnu/bin/salmon-euro-introgression/scripts/")

library(tidyverse)
library("ggplot2")
theme_set(theme_bw())
library("sf")

library("rnaturalearth")
library("rnaturalearthdata")


####
# set the location
####

setwd("C:/Users/camnu/bin/salmon-euro-introgression/scripts/")

data_path = "../data/May2022_SNPchip_220K/"

snp220_meta_file  = paste0(data_path, "SNPchip_100MS_SNPpanel_King7_Compare/SNPchip_220K/CIGENE_220K_Metadata_All_May18_2022.txt")

read_220_snp_meta = function(snp220_meta_file){
  columns = c("location_id", "fish_id", "location_name", "data_class", 
              "lat", "lon", "date_of_genotyping")
  
  data = read_tsv(snp220_meta_file, col_names = columns)
  
}

long_data = read_220_snp_meta(snp220_meta_file)

table(long_data$data_class)

#Aqua_Wild_Mix         Aquaculture Aquaculture Escapee Aquaculture_Escapee  Aquaculture_Norway  Aquculture_Iceland 
#195                 440                   9                 487                 187                  18 
#NorthAm              Norway             Unknown 
#5570                 806                  27 
wild = c("NorthAm", "Norway")

print("just the wild samples for the maps")
long_data = long_data[long_data$data_class %in% wild, ]
print("6376 wild fish")
print("1363 aquaculutre or mixed")

sample_count_data = long_data %>%
          group_by(location_id)%>%
            summarize(sample_size=n(),
                      location_name = min(location_name), 
                      lat = min(lat),
                      lon = min(lon))




world = ne_countries(scale = "medium", returnclass = "sf")
class(world)

#plot a sub region
lat_min = min(sample_count_data$lat, na.rm=TRUE)
lat_max = max(sample_count_data$lat, na.rm=TRUE)
long_min = min(sample_count_data$lon, na.rm=TRUE)
long_max = max(sample_count_data$lon, na.rm=TRUE)


table(sample_count_data$sample_size)
min(sample_count_data$sample_size)
max(sample_count_data$sample_size)

hist(sample_count_data$sample_size)


study_range = ggplot(data = world) +
  geom_sf() +
  coord_sf(xlim = c(long_min - 2, long_max + 2), 
           ylim = c(lat_min - 2, lat_max + 2), expand = FALSE) +
  labs(title = "Salmon introgression sampling locations - wild data only", 
       subtitle = "199 locations, 1-209 samples per location. Aquaculture samples don't have location")+
  geom_point(data = sample_count_data, aes(x = lon, y = lat, size=sample_size), alpha = 0.5)


ggsave('../data/external/salmon_introgression_wild_sampling_locations.png', study_range)

#199 wild locations with lat and long



na_samples = sample_count_data[sample_count_data$lon < -40,]
na_samples = na_samples[!is.na(na_samples$lon),]


na_long_min = min(NA_samples$lon, na.rm=TRUE) 
na_long_max = max(NA_samples$lon, na.rm=TRUE) 

na_lat_min = min(NA_samples$lat, na.rm=TRUE) 
na_lat_max = max(NA_samples$lat, na.rm=TRUE) 

na_study_range = ggplot(data = world) +
  geom_sf() +
  coord_sf(xlim = c(na_long_min - 2 ,na_long_max + 2), 
           ylim = c(na_lat_min - 2, na_lat_max + 2), expand = FALSE) +
  labs(title = "North American Salmon wild sampling locations ", 
       subtitle = "148 locations.")+
  geom_point(data = na_samples, aes(x = lon, y = lat, size=sample_size), alpha = 0.5)


ggsave('../data/external/NA_sampling_locations.png', na_study_range)


EU_samples = sample_count_data[sample_count_data$lon > -40,]
EU_samples = EU_samples[!is.na(EU_samples$lon),]

EU_long_min = min(EU_samples$lon, na.rm=TRUE) 
EU_long_max = max(EU_samples$lon, na.rm=TRUE) 

EU_lat_min = min(EU_samples$lat, na.rm=TRUE) 
EU_lat_max = max(EU_samples$lat, na.rm=TRUE) 

EU_study_range = ggplot(data = world) +
  geom_sf() +
  coord_sf(xlim = c(EU_long_min - 2 ,EU_long_max + 2), 
           ylim = c(EU_lat_min - 2, EU_lat_max + 2), expand = FALSE) +
  labs(title = "European Salmon wild sampling locations ", 
       subtitle = "50 locations (All Norway)")+
  geom_point(data = EU_samples, aes(x = lon, y = lat, size=sample_size), alpha = 0.5)

ggsave('../data/external/EU_sampling_locations.png', EU_study_range)


print("Note: Lomond River East Branch	NorthAm	49.4029	-57.613973 ")
print("changed from positive 57, its not in Kazakhstan!")