
############
# load libraries

library(tidyverse)
library(ggman)


############
# set path
data_path = "C:/Users/camnu/bin/salmon-genomic-vulnerability/data/"
setwd(data_path)



###########
# get individual lists to subset the plink files


clustered_full_data_PCA = read_tsv("interim/full_data_PCA_kmeans_cluster_info.tsv")
#clustered_matched_data_PCA = read_tsv("interim/matched_data_PCA_kmeans_cluster_info.tsv")

cluster_names = c("Labrador", "Newfoundland", "St. Lawrence")

#c = "Labrador"
for(c in cluster_names){
  
  sub_df = clustered_full_data_PCA[clustered_full_data_PCA$cluster_name == c,]
  
  out_df = sub_df[c("SiteCode", "fish_id")]

  names(out_df) = c("FID", "IID")
  

  write_tsv(out_df, paste0("raw/LD_files/", c, "_individual_list.tsv"))  
}


############
# plink code to subset the bam files and make the smaller individual sets
print("subset the clusters")
#435 samples:
#plink --bfile wildNA_220k_filtered --chr-set 30 no-xy --maf 0.01 --make-bed --keep LD_files/Labrador_individual_list.tsv --out LD_files/Labrador_220k_filtered

#3244 samples:
#plink --bfile wildNA_220k_filtered --chr-set 30 no-xy --maf 0.01 --make-bed --keep LD_files/Newfoundland_individual_list.tsv  --out LD_files/Newfoundland_220k_filtered

#1776 samples:
#plink --bfile wildNA_220k_filtered --chr-set 30 no-xy --maf 0.01 --make-bed --keep LD_files/STLawrence_individual_list.tsv  --out LD_files/STLawrence_220k_filtered

print("run the LD analysis")
#full
#plink --bfile wildNA_220k_filtered --chr-set 30 no-xy --ld-window-kb 10 --r2 --keep LD_files/Labrador_individual_list.tsv --out LD_files/full_220k_filtered_LD_out

#435 samples:
#plink --bfile LD_files/Labrador_220k_filtered --chr-set 30 no-xy --ld-window-kb 10 --r2 --out LD_files/Labrador_LD_output

#3244 samples:
#plink --bfile LD_files/Newfoundland_220k_filtered --chr-set 30 no-xy --ld-window-kb 10 --r2 --out LD_files/Newfoundland_LD_output

#1776 samples:
#plink --bfile LD_files/STLawrence_220k_filtered --chr-set 30 no-xy --ld-window-kb 10 --r2 --out LD_files/STLawrence_LD_output





