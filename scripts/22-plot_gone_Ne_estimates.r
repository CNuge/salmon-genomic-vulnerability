
############
# load libraries
library(tidyverse)
theme_set(theme_bw())


############
# set path
data_path = "C:/Users/camnu/bin/salmon-genomic-vulnerability/data/interim/GONE_outputs/"
setwd(data_path)


#files to use:
# High Q, ignorning the admixture zones as per instructions in the manual
# data are LD filtered, which is also required

#all done with max generation of 2000, none went beyond ~750 
#plot up line plots for three populations over last 500 generations if possible.

#read in and skip first row, should make tidy tab delimited table from there.

LAB_ne_file = "Output_Ne_high_Q_Labrador_220k_filtered"
NFL_ne_file = "Output_Ne_ds_high_Q_Newfoundland_220k_filtered"
STL_ne_file = "Output_Ne_high_Q_STLawrence_220k_filtered"


#read in the data, skipping the first line
# which just says "Ne averages over 40 independent estimates."
LAB_ne_df = read_table(LAB_ne_file, skip = 1)
NFL_ne_df = read_table(NFL_ne_file, skip = 1)
STL_ne_df = read_table(STL_ne_file, skip = 1)


#Output_d2_high_Q_Labrador_220k_filtered
#Output_d2_ds_high_Q_Newfoundland_220k_filtered
#Output_d2_high_Q_STLawrence_220k_filtered

#all three have > 650 rows, min == 676
# I will therefore use this in the plot
nrow(LAB_ne_df)
nrow(NFL_ne_df)
nrow(STL_ne_df)


LAB_ne_df$population = "LAB"
NFL_ne_df$population = "NFL"
STL_ne_df$population = "STL"


ne_combined_df = rbind(LAB_ne_df[1:500,],NFL_ne_df[1:500,],STL_ne_df[1:500,])

#CONFIRM 650 for each
nrow(ne_combined_df) == (500*3)
table(ne_combined_df$population)


ne_plot = ggplot(data = ne_combined_df, aes(x=Generation, y=Geometric_mean, group=population, color=population)) +
  geom_line() +
  theme_bw() + 
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank())+
  labs(title = "GoNE estimate of historic effective population size for three populations", 
       color = "Population", x = "Generations in the past", y = "Effective population size (Ne)")


ggsave('../../external/Ne_gone_per_population.jpeg', ne_plot)

