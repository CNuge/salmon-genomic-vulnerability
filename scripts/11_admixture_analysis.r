
############
# load libraries

library(tidyverse)
library(ggman)
theme_set(theme_bw())


############
# set path
data_path = "C:/Users/camnu/bin/salmon-genomic-vulnerability/data/"
setwd(data_path)



#############
# conduct the admixture analysis 


##full data set, k == 3 based on the clustering work
# admixture wildNA_220k_filtered.bed 3





##########
# plot the result

print("swap this file for more up to date one with the clusters and things")
NA_baseline_Meta = read_tsv('filtered_wild_individuals_meta_data.tsv')
table(NA_baseline_Meta$Province)

################################################################################
print("k=3")
meta_k3_Q_vals = cbind(NA_baseline_Meta, AdmixQ3_data)

meta_k3_Q_vals = meta_k3_Q_vals[meta_k3_Q_vals$Province != "NA", ]

k3_qlong = gather(meta_k3_Q_vals, Q_type, Q, Q1, Q2, Q3) 
k3_qlong =k3_qlong[order(k3_qlong$data_class, k3_qlong$location_id),]
k3_qlong$data_class = as.factor(k3_qlong$Province)

print("can change order by sitecode to something else, i.e. province")
k3_admix_bar = ggplot(data=k3_qlong, aes(x=reorder(fish_id, data_class), y=Q, fill=Q_type))+
  geom_bar(stat = "identity")+
  scale_y_continuous(expand = c(0,0))+
  ylab("Admixture proportion")+
  labs(title="Admixture of NA wild samples", 
       subtitle = "5455 NA fish only, K=3")+
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.title.x = element_blank(),
        strip.text = element_text(colour="black", size=12),
        panel.grid = element_blank(),
        panel.background = element_blank(),
        legend.title = element_blank(),
        legend.text = element_text(size = 12))


ggsave('../../../external/NA_wild_k3_ADMIX.png', k2_admix_bar)


print("faceted plot")
k3_panel_facet_admix_bar = ggplot(data=k3_qlong, aes(x=reorder(fish_id, SiteCode), y=Q, fill=Q_type))+
  geom_bar(stat = "identity")+
  scale_y_continuous(expand = c(0,0))+
  facet_wrap(~data_class, scales = "free", ncol = 2)+
  ylab("Admixture proportion")+
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.title.x = element_blank(),
        strip.text = element_text(colour="black", size=12),
        panel.grid = element_blank(),
        panel.background = element_blank(),
        legend.title = element_blank(),
        legend.text = element_text(size = 12))

ggsave(paste0('../../../external/wild_na_faceted_province_ADMIX_k3.png'), k3_panel_facet_admix_bar)

